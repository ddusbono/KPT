<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>KPT ÌöåÍ≥†</title>
    <style>
      :root {
        color-scheme: light dark;
        --primary: #2f6fed;
        --primary-hover: #5f8df7;
        --keep-bg: #e8f5e9;
        --keep-border: #4caf50;
        --problem-bg: #ffebee;
        --problem-border: #f44336;
        --try-bg: #e3f2fd;
        --try-border: #2196f3;
      }

      * {
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
        background: #f4f6fb;
        min-height: 100vh;
        margin: 0;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      header {
        text-align: center;
        margin-bottom: 30px;
        position: relative;
      }

      .user-info {
        position: absolute;
        top: 0;
        right: 0;
        display: flex;
        align-items: center;
        gap: 15px;
        font-size: 14px;
        color: #4b5666;
      }

      .user-name {
        font-weight: 600;
      }

      .logout-btn {
        padding: 8px 16px;
        border: 1px solid #d7deea;
        border-radius: 6px;
        background: #fff;
        color: #2f6fed;
        cursor: pointer;
        font-size: 13px;
        font-weight: 600;
        transition: all 0.2s;
      }

      .logout-btn:hover {
        background: #f0f4ff;
        border-color: #2f6fed;
      }

      h1 {
        font-size: 32px;
        margin: 0 0 10px;
        color: #1e2a3b;
        font-weight: 700;
      }

      .date-selector-wrapper {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-top: 20px;
        margin-bottom: 24px;
        gap: 20px;
        position: relative;
      }

      .date-selector {
        display: flex;
        align-items: center;
        gap: 15px;
        flex: 0 0 auto;
        justify-content: center;
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
      }

      .header-actions {
        display: flex;
        align-items: center;
        gap: 10px;
        flex-shrink: 0;
      }

      .header-actions:first-child {
        visibility: hidden;
      }

      .date-input {
        padding: 10px 15px;
        border: 1px solid #d7deea;
        border-radius: 8px;
        font-size: 15px;
        background: #fff;
        cursor: pointer;
      }

      .date-input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(47, 111, 237, 0.15);
      }

      .sections {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        gap: 24px;
        margin-bottom: 30px;
      }

      .section {
        background: #fff;
        border-radius: 16px;
        padding: 24px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        display: flex;
        flex-direction: column;
        min-height: 400px;
      }

      .section-header {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid;
      }

      .section.keep .section-header {
        border-color: var(--keep-border);
        color: #2e7d32;
      }

      .section.problem .section-header {
        border-color: var(--problem-border);
        color: #c62828;
      }

      .section.try .section-header {
        border-color: var(--try-border);
        color: #1565c0;
      }

      .section-icon {
        font-size: 24px;
      }

      .section-title {
        font-size: 20px;
        font-weight: 600;
        margin: 0;
      }

      .section-count {
        margin-left: auto;
        background: rgba(0, 0, 0, 0.1);
        padding: 4px 10px;
        border-radius: 12px;
        font-size: 13px;
        font-weight: 600;
      }

      .section-action-btn {
        background: none;
        border: none;
        font-size: 18px;
        cursor: pointer;
        padding: 4px 8px;
        border-radius: 6px;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0.7;
      }

      .section-action-btn:hover {
        opacity: 1;
        background: rgba(0, 0, 0, 0.05);
        transform: scale(1.1);
      }

      .section.try .section-action-btn {
        color: #1565c0;
      }

      .section.try .section-action-btn:hover {
        background: rgba(33, 150, 243, 0.1);
      }

      .items-list {
        flex: 1;
        min-height: 200px;
      }

      .item {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 12px 15px;
        margin-bottom: 10px;
        display: flex;
        align-items: flex-start;
        gap: 10px;
        transition: transform 0.2s, box-shadow 0.2s;
        animation: slideIn 0.3s ease-out;
      }

      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .item:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .item-text {
        flex: 1;
        font-size: 15px;
        line-height: 1.5;
        color: #2c3e50;
        word-break: break-word;
      }

      .item-delete {
        background: none;
        border: none;
        color: #dc3545;
        cursor: pointer;
        font-size: 18px;
        padding: 0;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 4px;
        transition: background 0.2s;
        flex-shrink: 0;
      }

      .item-delete:hover {
        background: rgba(220, 53, 69, 0.1);
      }

      .add-form {
        margin-top: 15px;
        display: flex;
        gap: 8px;
      }

      .add-input {
        flex: 1;
        padding: 12px 15px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 15px;
        outline: none;
        transition: border-color 0.2s;
      }

      .add-input:focus {
        border-color: var(--primary);
      }

      .add-btn {
        padding: 12px 20px;
        border: none;
        border-radius: 8px;
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.1s, box-shadow 0.2s;
        white-space: nowrap;
      }

      .section.keep .add-btn {
        background: var(--keep-border);
        color: #fff;
      }

      .section.problem .add-btn {
        background: var(--problem-border);
        color: #fff;
      }

      .section.try .add-btn {
        background: var(--try-border);
        color: #fff;
      }

      .add-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      }

      .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: #9e9e9e;
        font-size: 14px;
      }

      .header-actions .btn {
        width: 44px;
        height: 44px;
        padding: 0;
        border: 2px solid;
        border-radius: 10px;
        font-size: 20px;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        font-weight: normal;
      }

      .header-actions .btn-primary {
        background: linear-gradient(135deg, var(--primary), var(--primary-hover));
        border-color: var(--primary);
        color: #fff;
      }

      .header-actions .btn-secondary {
        background: linear-gradient(135deg, #6c757d, #7a8288);
        border-color: #6c757d;
        color: #fff;
      }

      .header-actions .btn-success {
        background: linear-gradient(135deg, #28a745, #34ce57);
        border-color: #28a745;
        color: #fff;
      }

      .header-actions .btn-danger {
        background: linear-gradient(135deg, #dc3545, #e4606d);
        border-color: #dc3545;
        color: #fff;
      }

      .header-actions .btn:hover {
        transform: translateY(-3px) scale(1.08);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.25);
        border-width: 2px;
      }

      .header-actions .btn:active {
        transform: translateY(-1px) scale(1.02);
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
      }

      .header-actions .btn[title]:hover::after {
        content: attr(title);
        position: absolute;
        bottom: -35px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.8);
        color: #fff;
        padding: 6px 10px;
        border-radius: 6px;
        font-size: 12px;
        white-space: nowrap;
        z-index: 1000;
        pointer-events: none;
      }

      .header-actions .btn[title]:hover::before {
        content: '';
        position: absolute;
        bottom: -8px;
        left: 50%;
        transform: translateX(-50%);
        border: 5px solid transparent;
        border-bottom-color: rgba(0, 0, 0, 0.8);
        z-index: 1000;
        pointer-events: none;
      }

      .bottom-sections {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 24px;
        margin-top: 40px;
      }

      .date-manager {
        padding: 24px;
        background: #fff;
        border-radius: 16px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      }

      .date-manager h3 {
        margin: 0 0 20px;
        color: #1e2a3b;
        font-size: 20px;
      }

      .date-list {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 12px;
        margin-bottom: 20px;
      }

      .date-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px 16px;
        background: #f8f9fa;
        border-radius: 8px;
        border: 1px solid #e0e0e0;
      }

      .date-item-info {
        flex: 1;
      }

      .date-item-date {
        font-weight: 600;
        color: #1e2a3b;
        font-size: 14px;
      }

      .date-item-count {
        font-size: 12px;
        color: #6b778c;
        margin-top: 4px;
      }

      .date-item-actions {
        display: flex;
        gap: 8px;
      }

      .date-item-btn {
        padding: 6px 12px;
        border: none;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
      }

      .date-item-btn-copy {
        background: #e3f2fd;
        color: #2196f3;
      }

      .date-item-btn-delete {
        background: #ffebee;
        color: #f44336;
      }

      .date-item-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      }

      .toast {
        position: fixed;
        bottom: 20px;
        right: 20px;
        padding: 16px 24px;
        background: #28a745;
        color: #fff;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        z-index: 1000;
        animation: slideIn 0.3s ease-out;
        display: none;
      }

      .toast.show {
        display: block;
      }

      @keyframes slideIn {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      .todo-section {
        background: #fff;
        border-radius: 16px;
        padding: 24px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      }

      .todo-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #2196f3;
      }

      .todo-title {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 20px;
        font-weight: 600;
        color: #1565c0;
        margin: 0;
      }

      .todo-stats {
        font-size: 14px;
        color: #6b778c;
      }

      .todo-list {
        margin-bottom: 20px;
        min-height: 100px;
      }

      .todo-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px 15px;
        background: #f8f9fa;
        border-radius: 8px;
        margin-bottom: 8px;
        transition: all 0.2s;
      }

      .todo-item:hover {
        background: #e9ecef;
        transform: translateX(4px);
      }

      .todo-item.completed {
        opacity: 0.6;
      }

      .todo-item.completed .todo-text {
        text-decoration: line-through;
        color: #6b778c;
      }

      .todo-checkbox {
        width: 20px;
        height: 20px;
        cursor: pointer;
        accent-color: #2196f3;
      }

      .todo-text {
        flex: 1;
        font-size: 15px;
        color: #2c3e50;
        word-break: break-word;
      }

      .todo-delete {
        background: none;
        border: none;
        color: #dc3545;
        cursor: pointer;
        font-size: 18px;
        padding: 0;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 4px;
        transition: background 0.2s;
        flex-shrink: 0;
      }

      .todo-delete:hover {
        background: rgba(220, 53, 69, 0.1);
      }

      .todo-add-form {
        display: flex;
        gap: 8px;
        margin-bottom: 15px;
      }

      .todo-add-input {
        flex: 1;
        padding: 12px 15px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 15px;
        outline: none;
        transition: border-color 0.2s;
      }

      .todo-add-input:focus {
        border-color: #2196f3;
      }

      .todo-add-btn {
        padding: 12px 20px;
        border: none;
        border-radius: 8px;
        font-size: 15px;
        font-weight: 600;
        background: #2196f3;
        color: #fff;
        cursor: pointer;
        transition: transform 0.1s, box-shadow 0.2s;
        white-space: nowrap;
      }

      .todo-add-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3);
      }


      @media (prefers-color-scheme: dark) {
        body {
          background: #0f1728;
        }

        .section {
          background: #1b2539;
          box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
        }

        h1 {
          color: #f8f9fc;
        }

        .date-input {
          background: #131c2f;
          border-color: #2d3a55;
          color: #f8f9fc;
        }


        .item {
          background: #131c2f;
        }

        .item-text {
          color: #e0e6ed;
        }

        .add-input {
          background: #131c2f;
          border-color: #2d3a55;
          color: #f8f9fc;
        }

        .empty-state {
          color: #6b778c;
        }

        .user-info {
          color: #c0c8d8;
        }

        .logout-btn {
          background: #131c2f;
          border-color: #2d3a55;
          color: #5f8df7;
        }

        .logout-btn:hover {
          background: #1b2539;
          border-color: #5f8df7;
        }

        .date-manager {
          background: #1b2539;
        }

        .date-manager h3 {
          color: #f8f9fc;
        }

        .date-item {
          background: #131c2f;
          border-color: #2d3a55;
        }

        .date-item-date {
          color: #f8f9fc;
        }

        .date-item-count {
          color: #aab4ce;
        }

        .date-item-btn-copy {
          background: #1b3a5e;
          color: #5f8df7;
        }

        .date-item-btn-delete {
          background: #4a1f1f;
          color: #f44336;
        }

        .todo-section {
          background: #1b2539;
        }

        .todo-header {
          border-color: #2196f3;
        }

        .todo-title {
          color: #5f8df7;
        }

        .todo-stats {
          color: #aab4ce;
        }

        .todo-item {
          background: #131c2f;
        }

        .todo-item:hover {
          background: #1b2539;
        }

        .todo-item.completed .todo-text {
          color: #6b778c;
        }

        .todo-text {
          color: #e0e6ed;
        }

        .todo-add-input {
          background: #131c2f;
          border-color: #2d3a55;
          color: #f8f9fc;
        }

        .section.try .section-action-btn {
          color: #5f8df7;
        }

        .section.try .section-action-btn:hover {
          background: rgba(95, 141, 247, 0.2);
        }
      }

      @media (max-width: 768px) {
        body {
          padding: 10px;
        }

        h1 {
          font-size: 24px;
        }

        .user-info {
          position: static;
          justify-content: center;
          margin-bottom: 10px;
          flex-wrap: wrap;
        }

        .date-selector-wrapper {
          flex-direction: column;
          gap: 15px;
          margin-top: 15px;
        }

        .date-selector {
          position: static;
          transform: none;
          width: 100%;
          flex-direction: column;
          gap: 10px;
        }

        .header-actions:first-child {
          display: none;
        }

        .header-actions {
          justify-content: center;
          width: 100%;
        }

        .header-actions .btn {
          width: 48px;
          height: 48px;
          font-size: 22px;
        }

        .date-input {
          padding: 12px;
          font-size: 16px; /* iOS ÏûêÎèô Ï§å Î∞©ÏßÄ */
          width: 100%;
        }

        .sections {
          grid-template-columns: 1fr;
          gap: 16px;
        }

        .section {
          padding: 16px;
          min-height: auto;
        }

        .section-header {
          flex-wrap: wrap;
          gap: 8px;
        }

        .section-title {
          font-size: 18px;
        }

        .section-icon {
          font-size: 20px;
        }

        .add-input, .todo-add-input {
          padding: 14px;
          font-size: 16px; /* iOS ÏûêÎèô Ï§å Î∞©ÏßÄ */
        }

        .add-btn, .todo-add-btn {
          padding: 14px 20px;
          font-size: 16px;
        }

        .item, .todo-item {
          padding: 14px;
        }

        .item-text, .todo-text {
          font-size: 15px;
        }

        .item-delete, .todo-delete {
          width: 32px;
          height: 32px;
          font-size: 20px;
        }

        .bottom-sections {
          grid-template-columns: 1fr;
          gap: 20px;
        }

        .todo-section, .date-manager {
          padding: 16px;
        }

        .todo-header {
          flex-wrap: wrap;
          gap: 10px;
        }

        .todo-title {
          font-size: 18px;
        }

        .date-list {
          grid-template-columns: 1fr;
        }

        .date-item {
          flex-direction: column;
          align-items: flex-start;
          gap: 10px;
        }

        .date-item-actions {
          width: 100%;
          justify-content: flex-end;
        }

        .actions {
          flex-direction: column;
          gap: 10px;
        }

        .btn {
          width: 100%;
        }
      }

      /* ÏûëÏùÄ Î™®Î∞îÏùº (480px Ïù¥Ìïò) */
      @media (max-width: 480px) {
        body {
          padding: 8px;
        }

        h1 {
          font-size: 20px;
        }

        .section {
          padding: 12px;
        }

        .header-actions .btn {
          width: 44px;
          height: 44px;
          font-size: 20px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <div class="user-info" id="user-info" style="display: none;">
          <span class="user-name" id="user-name"></span>
          <button class="logout-btn" onclick="logout()">Î°úÍ∑∏ÏïÑÏõÉ</button>
        </div>
        <h1>üìù KPT ÌöåÍ≥†</h1>
        <div class="date-selector-wrapper">
          <div class="header-actions"></div>
          <div class="date-selector">
            <label for="retro-date">ÌöåÍ≥† ÎÇ†Ïßú:</label>
            <input
              type="date"
              id="retro-date"
              class="date-input"
              value=""
            />
          </div>
          <div class="header-actions">
            <button class="btn btn-success" onclick="copyToClipboard()" title="ÌÅ¥Î¶ΩÎ≥¥ÎìúÎ°ú Î≥µÏÇ¨">
              üìã
            </button>
            <button class="btn btn-danger" onclick="clearAll()" title="ÌòÑÏû¨ ÎÇ†Ïßú ÏÇ≠Ï†ú">
              üóëÔ∏è
            </button>
            <button class="btn btn-primary" onclick="exportData()" title="Îç∞Ïù¥ÌÑ∞ ÎÇ¥Î≥¥ÎÇ¥Í∏∞">
              üíæ
            </button>
            <button class="btn btn-primary" onclick="importData()" title="Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞">
              üì•
            </button>
          </div>
        </div>
      </header>

      <div class="sections">
        <div class="section keep">
          <div class="section-header">
            <span class="section-icon">‚úÖ</span>
            <h2 class="section-title">Keep (Ïú†ÏßÄÌï† Í≤É)</h2>
            <span class="section-count" id="keep-count">0</span>
          </div>
          <div class="items-list" id="keep-list"></div>
          <div class="add-form">
            <input
              type="text"
              class="add-input"
              id="keep-input"
              placeholder="Ïûò ÎêòÍ≥† ÏûàÎäî Í≤ÉÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî..."
            />
            <button class="add-btn" onclick="addItem('keep')">Ï∂îÍ∞Ä</button>
          </div>
        </div>

        <div class="section problem">
          <div class="section-header">
            <span class="section-icon">‚ö†Ô∏è</span>
            <h2 class="section-title">Problem (Î¨∏Ï†úÏ†ê)</h2>
            <span class="section-count" id="problem-count">0</span>
          </div>
          <div class="items-list" id="problem-list"></div>
          <div class="add-form">
            <input
              type="text"
              class="add-input"
              id="problem-input"
              placeholder="Í∞úÏÑ†Ïù¥ ÌïÑÏöîÌïú Î∂ÄÎ∂ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî..."
            />
            <button class="add-btn" onclick="addItem('problem')">Ï∂îÍ∞Ä</button>
          </div>
        </div>

        <div class="section try">
          <div class="section-header">
            <span class="section-icon">üöÄ</span>
            <h2 class="section-title">Try (ÏãúÎèÑÌï† Í≤É)</h2>
            <button 
              class="section-action-btn" 
              onclick="convertTryToTodos()" 
              title="Try Ìï≠Î™©ÏùÑ Ìï†ÏùºÎ°ú Î≥ÄÌôò"
            >
              ‚ûï
            </button>
            <span class="section-count" id="try-count">0</span>
          </div>
          <div class="items-list" id="try-list"></div>
          <div class="add-form">
            <input
              type="text"
              class="add-input"
              id="try-input"
              placeholder="ÏÉàÎ°≠Í≤å ÏãúÎèÑÌï† Í≤ÉÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî..."
            />
            <button class="add-btn" onclick="addItem('try')">Ï∂îÍ∞Ä</button>
          </div>
        </div>
      </div>

      <div class="bottom-sections">
        <div class="todo-section">
          <div class="todo-header">
            <h3 class="todo-title">
              <span>üìã</span>
              Ïò§ÎäòÏùò Ìï†Ïùº
            </h3>
            <div class="todo-stats" id="todo-stats">0Í∞ú Ï§ë 0Í∞ú ÏôÑÎ£å</div>
          </div>
          <div class="todo-list" id="todo-list"></div>
          <div class="todo-add-form">
            <input
              type="text"
              class="todo-add-input"
              id="todo-input"
              placeholder="Ìï†ÏùºÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî..."
            />
            <button class="todo-add-btn" onclick="addTodo()">Ï∂îÍ∞Ä</button>
          </div>
        </div>

        <div class="date-manager">
          <h3>üìÖ ÎÇ†ÏßúÎ≥Ñ Îç∞Ïù¥ÌÑ∞ Í¥ÄÎ¶¨</h3>
          <div class="date-list" id="date-list"></div>
        </div>
      </div>

      <div class="toast" id="toast">ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!</div>
    </div>

    <script>
      // Î°úÍ∑∏Ïù∏ Ï≤¥ÌÅ¨
      function checkLogin() {
        const currentUser = localStorage.getItem('currentUser');
        if (!currentUser) {
          alert('Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
          window.location.href = 'login.html';
          return false;
        }

        const user = JSON.parse(currentUser);
        if (!user.loggedIn) {
          alert('Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
          window.location.href = 'login.html';
          return false;
        }

        // ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ ÌëúÏãú
        document.getElementById('user-name').textContent = `${user.name}Îãò`;
        document.getElementById('user-info').style.display = 'flex';
        return true;
      }

      // Î°úÍ∑∏ÏïÑÏõÉ
      function logout() {
        if (confirm('Î°úÍ∑∏ÏïÑÏõÉ ÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
          localStorage.removeItem('currentUser');
          window.location.href = 'login.html';
        }
      }

      // Î°úÍ∑∏Ïù∏ Ï≤¥ÌÅ¨ ÌõÑ ÏßÑÌñâ
      if (!checkLogin()) {
        // Î°úÍ∑∏Ïù∏ ÌéòÏù¥ÏßÄÎ°ú Î¶¨Îã§Ïù¥Î†âÌä∏ÎêòÎØÄÎ°ú Ïó¨Í∏∞ÏÑú Ï§ëÎã®
      }

      // Ïò§Îäò ÎÇ†ÏßúÎ•º Í∏∞Î≥∏Í∞íÏúºÎ°ú ÏÑ§Ï†ï
      document.getElementById('retro-date').valueAsDate = new Date();

      // Îç∞Ïù¥ÌÑ∞ Íµ¨Ï°∞ (ÏÇ¨Ïö©ÏûêÎ≥ÑÎ°ú Ï†ÄÏû•)
      const currentUser = JSON.parse(localStorage.getItem('currentUser'));
      const userId = currentUser ? currentUser.userId : 'guest';
      
      let kptData = {
        date: new Date().toISOString().split('T')[0],
        keep: [],
        problem: [],
        try: []
      };

      // Ìï†Ïùº Îç∞Ïù¥ÌÑ∞ Íµ¨Ï°∞
      let todos = [];

      // Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Î°úÎìú
      function loadData() {
        const date = document.getElementById('retro-date').value;
        const saved = localStorage.getItem(`kpt_${userId}_${date}`);
        if (saved) {
          kptData = JSON.parse(saved);
        } else {
          kptData = {
            date: date,
            keep: [],
            problem: [],
            try: []
          };
        }
        renderAll();
        loadTodos();
      }

      // Ìï†Ïùº Îç∞Ïù¥ÌÑ∞ Î°úÎìú
      function loadTodos() {
        const today = new Date().toISOString().split('T')[0];
        const saved = localStorage.getItem(`todos_${userId}_${today}`);
        if (saved) {
          todos = JSON.parse(saved);
        } else {
          todos = [];
        }
        renderTodos();
      }

      // Ìï†Ïùº Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
      function saveTodos() {
        const today = new Date().toISOString().split('T')[0];
        localStorage.setItem(`todos_${userId}_${today}`, JSON.stringify(todos));
      }

      // Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
      function saveData() {
        const date = document.getElementById('retro-date').value;
        kptData.date = date;
        localStorage.setItem(`kpt_${userId}_${date}`, JSON.stringify(kptData));
      }

      // ÏïÑÏù¥ÌÖú Ï∂îÍ∞Ä
      function addItem(type) {
        const input = document.getElementById(`${type}-input`);
        const text = input.value.trim();
        
        if (text === '') {
          alert('ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
          return;
        }

        kptData[type].push({
          id: Date.now(),
          text: text,
          createdAt: new Date().toISOString()
        });

        input.value = '';
        saveData();
        renderAll();
        renderDateList();
      }

      // ÏïÑÏù¥ÌÖú ÏÇ≠Ï†ú
      function deleteItem(type, id) {
        kptData[type] = kptData[type].filter(item => item.id !== id);
        saveData();
        renderAll();
        renderDateList();
      }

      // ÏÑπÏÖò Î†åÎçîÎßÅ
      function renderSection(type) {
        const list = document.getElementById(`${type}-list`);
        const items = kptData[type] || [];
        const count = document.getElementById(`${type}-count`);

        count.textContent = items.length;

        if (items.length === 0) {
          list.innerHTML = '<div class="empty-state">ÏïÑÏßÅ Ìï≠Î™©Ïù¥ ÏóÜÏäµÎãàÎã§.<br>ÏúÑ ÏûÖÎ†•Ï∞ΩÏóê Ï∂îÍ∞ÄÌï¥Î≥¥ÏÑ∏Ïöî!</div>';
          return;
        }

        list.innerHTML = items.map(item => `
          <div class="item">
            <div class="item-text">${escapeHtml(item.text)}</div>
            <button class="item-delete" onclick="deleteItem('${type}', ${item.id})" title="ÏÇ≠Ï†ú">√ó</button>
          </div>
        `).join('');
      }

      // Ï†ÑÏ≤¥ Î†åÎçîÎßÅ
      function renderAll() {
        renderSection('keep');
        renderSection('problem');
        renderSection('try');
      }

      // Ìï†Ïùº Ï∂îÍ∞Ä
      function addTodo() {
        const input = document.getElementById('todo-input');
        const text = input.value.trim();
        
        if (text === '') {
          alert('Ìï†ÏùºÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
          return;
        }

        todos.push({
          id: Date.now(),
          text: text,
          completed: false,
          createdAt: new Date().toISOString()
        });

        input.value = '';
        saveTodos();
        renderTodos();
      }

      // Ìï†Ïùº ÏôÑÎ£å/ÎØ∏ÏôÑÎ£å ÌÜ†Í∏Ä
      function toggleTodo(id) {
        const todo = todos.find(t => t.id === id);
        if (todo) {
          todo.completed = !todo.completed;
          saveTodos();
          renderTodos();
        }
      }

      // Ìï†Ïùº ÏÇ≠Ï†ú
      function deleteTodo(id) {
        todos = todos.filter(t => t.id !== id);
        saveTodos();
        renderTodos();
      }

      // Ìï†Ïùº Î†åÎçîÎßÅ
      function renderTodos() {
        const list = document.getElementById('todo-list');
        const stats = document.getElementById('todo-stats');
        
        const completedCount = todos.filter(t => t.completed).length;
        const totalCount = todos.length;
        stats.textContent = `${totalCount}Í∞ú Ï§ë ${completedCount}Í∞ú ÏôÑÎ£å`;

        if (todos.length === 0) {
          list.innerHTML = '<div class="empty-state">Ìï†ÏùºÏù¥ ÏóÜÏäµÎãàÎã§.<br>ÏúÑ ÏûÖÎ†•Ï∞ΩÏóê Ï∂îÍ∞ÄÌï¥Î≥¥ÏÑ∏Ïöî!</div>';
          return;
        }

        list.innerHTML = todos.map(todo => `
          <div class="todo-item ${todo.completed ? 'completed' : ''}">
            <input
              type="checkbox"
              class="todo-checkbox"
              ${todo.completed ? 'checked' : ''}
              onchange="toggleTodo(${todo.id})"
            />
            <div class="todo-text">${escapeHtml(todo.text)}</div>
            <button class="todo-delete" onclick="deleteTodo(${todo.id})" title="ÏÇ≠Ï†ú">√ó</button>
          </div>
        `).join('');
      }

      // Try Ìï≠Î™©ÏùÑ Ìï†ÏùºÎ°ú Î≥ÄÌôò
      function convertTryToTodos() {
        if (!kptData.try || kptData.try.length === 0) {
          alert('Î≥ÄÌôòÌï† Try Ìï≠Î™©Ïù¥ ÏóÜÏäµÎãàÎã§.');
          return;
        }

        if (confirm(`Try Ìï≠Î™© ${kptData.try.length}Í∞úÎ•º Ìï†ÏùºÎ°ú Î≥ÄÌôòÌïòÏãúÍ≤†ÏäµÎãàÍπå?`)) {
          const today = new Date().toISOString().split('T')[0];
          
          kptData.try.forEach(item => {
            // Ïù¥ÎØ∏ Í∞ôÏùÄ ÌÖçÏä§Ìä∏Ïùò Ìï†ÏùºÏù¥ ÏûàÎäîÏßÄ ÌôïÏù∏
            const exists = todos.some(t => t.text === item.text);
            if (!exists) {
              todos.push({
                id: Date.now() + Math.random(), // Í≥†Ïú† ID ÏÉùÏÑ±
                text: item.text,
                completed: false,
                createdAt: new Date().toISOString(),
                fromTry: true // TryÏóêÏÑú Î≥ÄÌôòÎêú Í≤ÉÏûÑÏùÑ ÌëúÏãú
              });
            }
          });

          saveTodos();
          renderTodos();
          showToast(`${kptData.try.length}Í∞úÏùò Try Ìï≠Î™©Ïù¥ Ìï†ÏùºÎ°ú Î≥ÄÌôòÎêòÏóàÏäµÎãàÎã§!`);
        }
      }

      // HTML Ïù¥Ïä§ÏºÄÏù¥ÌîÑ
      function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }

      // Ï†ÑÏ≤¥ ÏÇ≠Ï†ú (ÌòÑÏû¨ ÎÇ†Ïßú)
      function clearAll() {
        const date = document.getElementById('retro-date').value;
        if (confirm(`ÌòÑÏû¨ ÎÇ†Ïßú(${date})Ïùò Î™®Îì† Ìï≠Î™©ÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?`)) {
          kptData = {
            date: date,
            keep: [],
            problem: [],
            try: []
          };
          saveData();
          renderAll();
          renderDateList();
        }
      }

      // ÌÅ¥Î¶ΩÎ≥¥ÎìúÎ°ú Î≥µÏÇ¨
      function copyToClipboard() {
        const date = document.getElementById('retro-date').value;
        const formatDate = (dateStr) => {
          const date = new Date(dateStr);
          return `${date.getFullYear()}ÎÖÑ ${date.getMonth() + 1}Ïõî ${date.getDate()}Ïùº`;
        };

        let text = `üìù KPT ÌöåÍ≥† - ${formatDate(date)}\n`;
        text += `${'='.repeat(40)}\n\n`;

        if (kptData.keep.length > 0) {
          text += `‚úÖ Keep (Ïú†ÏßÄÌï† Í≤É)\n`;
          kptData.keep.forEach((item, idx) => {
            text += `${idx + 1}. ${item.text}\n`;
          });
          text += '\n';
        }

        if (kptData.problem.length > 0) {
          text += `‚ö†Ô∏è Problem (Î¨∏Ï†úÏ†ê)\n`;
          kptData.problem.forEach((item, idx) => {
            text += `${idx + 1}. ${item.text}\n`;
          });
          text += '\n';
        }

        if (kptData.try.length > 0) {
          text += `üöÄ Try (ÏãúÎèÑÌï† Í≤É)\n`;
          kptData.try.forEach((item, idx) => {
            text += `${idx + 1}. ${item.text}\n`;
          });
          text += '\n';
        }

        // JSON ÌòïÏãùÎèÑ Ìï®Íªò Ï†úÍ≥µ
        const jsonText = JSON.stringify(kptData, null, 2);
        const fullText = `${text}\n${'='.repeat(40)}\n\n[JSON ÌòïÏãù]\n${jsonText}`;

        navigator.clipboard.writeText(fullText).then(() => {
          showToast('ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!');
        }).catch(() => {
          // ÌÅ¥Î¶ΩÎ≥¥Îìú APIÍ∞Ä ÏßÄÏõêÎêòÏßÄ ÏïäÎäî Í≤ΩÏö∞ ÎåÄÏ≤¥ Î∞©Î≤ï
          const textarea = document.createElement('textarea');
          textarea.value = fullText;
          document.body.appendChild(textarea);
          textarea.select();
          document.execCommand('copy');
          document.body.removeChild(textarea);
          showToast('ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!');
        });
      }

      // ÌÜ†Ïä§Ìä∏ Î©îÏãúÏßÄ ÌëúÏãú
      function showToast(message) {
        const toast = document.getElementById('toast');
        toast.textContent = message;
        toast.classList.add('show');
        setTimeout(() => {
          toast.classList.remove('show');
        }, 2000);
      }

      // ÎÇ†ÏßúÎ≥Ñ Îç∞Ïù¥ÌÑ∞ Î™©Î°ù Í∞ÄÏ†∏Ïò§Í∏∞
      function getAllDates() {
        const dates = [];
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          if (key && key.startsWith(`kpt_${userId}_`)) {
            const date = key.replace(`kpt_${userId}_`, '');
            try {
              const data = JSON.parse(localStorage.getItem(key));
              const totalCount = (data.keep?.length || 0) + 
                                (data.problem?.length || 0) + 
                                (data.try?.length || 0);
              dates.push({
                date: date,
                count: totalCount,
                data: data
              });
            } catch (e) {
              // Î¨¥Ïãú
            }
          }
        }
        // ÎÇ†ÏßúÏàúÏúºÎ°ú Ï†ïÎ†¨ (ÏµúÏã†Ïàú)
        return dates.sort((a, b) => new Date(b.date) - new Date(a.date));
      }

      // ÎÇ†Ïßú Î™©Î°ù Î†åÎçîÎßÅ
      function renderDateList() {
        const dateList = document.getElementById('date-list');
        const dates = getAllDates();

        if (dates.length === 0) {
          dateList.innerHTML = '<div class="empty-state" style="grid-column: 1/-1;">Ï†ÄÏû•Îêú ÎÇ†ÏßúÍ∞Ä ÏóÜÏäµÎãàÎã§.</div>';
          return;
        }

        dateList.innerHTML = dates.map(item => {
          const formatDate = (dateStr) => {
            const date = new Date(dateStr);
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            
            if (dateStr === today.toISOString().split('T')[0]) {
              return 'Ïò§Îäò';
            } else if (dateStr === yesterday.toISOString().split('T')[0]) {
              return 'Ïñ¥Ï†ú';
            } else {
              return `${date.getMonth() + 1}/${date.getDate()}`;
            }
          };

          return `
            <div class="date-item">
              <div class="date-item-info">
                <div class="date-item-date">${formatDate(item.date)}</div>
                <div class="date-item-count">${item.date} ¬∑ Ìï≠Î™© ${item.count}Í∞ú</div>
              </div>
              <div class="date-item-actions">
                <button class="date-item-btn date-item-btn-copy" onclick="copyDateToClipboard('${item.date}')" title="Î≥µÏÇ¨">üìã</button>
                <button class="date-item-btn date-item-btn-delete" onclick="deleteDate('${item.date}')" title="ÏÇ≠Ï†ú">üóëÔ∏è</button>
              </div>
            </div>
          `;
        }).join('');
      }

      // ÌäπÏ†ï ÎÇ†ÏßúÎ•º ÌÅ¥Î¶ΩÎ≥¥ÎìúÎ°ú Î≥µÏÇ¨
      function copyDateToClipboard(date) {
        const saved = localStorage.getItem(`kpt_${userId}_${date}`);
        if (!saved) {
          showToast('Îç∞Ïù¥ÌÑ∞Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
          return;
        }

        const data = JSON.parse(saved);
        const formatDate = (dateStr) => {
          const date = new Date(dateStr);
          return `${date.getFullYear()}ÎÖÑ ${date.getMonth() + 1}Ïõî ${date.getDate()}Ïùº`;
        };

        let text = `üìù KPT ÌöåÍ≥† - ${formatDate(date)}\n`;
        text += `${'='.repeat(40)}\n\n`;

        if (data.keep && data.keep.length > 0) {
          text += `‚úÖ Keep (Ïú†ÏßÄÌï† Í≤É)\n`;
          data.keep.forEach((item, idx) => {
            text += `${idx + 1}. ${item.text}\n`;
          });
          text += '\n';
        }

        if (data.problem && data.problem.length > 0) {
          text += `‚ö†Ô∏è Problem (Î¨∏Ï†úÏ†ê)\n`;
          data.problem.forEach((item, idx) => {
            text += `${idx + 1}. ${item.text}\n`;
          });
          text += '\n';
        }

        if (data.try && data.try.length > 0) {
          text += `üöÄ Try (ÏãúÎèÑÌï† Í≤É)\n`;
          data.try.forEach((item, idx) => {
            text += `${idx + 1}. ${item.text}\n`;
          });
          text += '\n';
        }

        const jsonText = JSON.stringify(data, null, 2);
        const fullText = `${text}\n${'='.repeat(40)}\n\n[JSON ÌòïÏãù]\n${jsonText}`;

        navigator.clipboard.writeText(fullText).then(() => {
          showToast(`${formatDate(date)} Îç∞Ïù¥ÌÑ∞Í∞Ä ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!`);
        }).catch(() => {
          const textarea = document.createElement('textarea');
          textarea.value = fullText;
          document.body.appendChild(textarea);
          textarea.select();
          document.execCommand('copy');
          document.body.removeChild(textarea);
          showToast(`${formatDate(date)} Îç∞Ïù¥ÌÑ∞Í∞Ä ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!`);
        });
      }

      // ÌäπÏ†ï ÎÇ†Ïßú Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú
      function deleteDate(date) {
        const formatDate = (dateStr) => {
          const date = new Date(dateStr);
          return `${date.getFullYear()}ÎÖÑ ${date.getMonth() + 1}Ïõî ${date.getDate()}Ïùº`;
        };

        if (confirm(`${formatDate(date)}Ïùò Îç∞Ïù¥ÌÑ∞Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?`)) {
          localStorage.removeItem(`kpt_${userId}_${date}`);
          
          // ÌòÑÏû¨ ÏÑ†ÌÉùÎêú ÎÇ†ÏßúÎùºÎ©¥ Îç∞Ïù¥ÌÑ∞ Ï¥àÍ∏∞Ìôî
          const currentDate = document.getElementById('retro-date').value;
          if (currentDate === date) {
            kptData = {
              date: date,
              keep: [],
              problem: [],
              try: []
            };
            renderAll();
          }
          
          renderDateList();
          showToast('Îç∞Ïù¥ÌÑ∞Í∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
        }
      }

      // Îç∞Ïù¥ÌÑ∞ ÎÇ¥Î≥¥ÎÇ¥Í∏∞
      function exportData() {
        const dataStr = JSON.stringify(kptData, null, 2);
        const dataBlob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(dataBlob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `kpt_${kptData.date}.json`;
        link.click();
        URL.revokeObjectURL(url);
      }

      // Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞
      function importData() {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = 'application/json';
        input.onchange = (e) => {
          const file = e.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = (event) => {
              try {
                const imported = JSON.parse(event.target.result);
                kptData = imported;
                document.getElementById('retro-date').value = kptData.date;
                saveData();
                renderAll();
                alert('Îç∞Ïù¥ÌÑ∞Î•º ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Í∞ÄÏ†∏ÏôîÏäµÎãàÎã§!');
              } catch (error) {
                alert('ÌååÏùº ÌòïÏãùÏù¥ Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏäµÎãàÎã§.');
              }
            };
            reader.readAsText(file);
          }
        };
        input.click();
      }

      // Enter ÌÇ§Î°ú Ï∂îÍ∞Ä
      document.getElementById('keep-input').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') addItem('keep');
      });

      document.getElementById('problem-input').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') addItem('problem');
      });

      document.getElementById('try-input').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') addItem('try');
      });

      // Ìï†Ïùº ÏûÖÎ†•Ï∞Ω Enter ÌÇ§
      document.getElementById('todo-input').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') addTodo();
      });

      // ÎÇ†Ïßú Î≥ÄÍ≤Ω Ïãú Îç∞Ïù¥ÌÑ∞ Î°úÎìú
      document.getElementById('retro-date').addEventListener('change', () => {
        loadData();
        renderDateList();
      });

      // Ï¥àÍ∏∞ Î°úÎìú
      loadData();
      renderDateList();
    </script>
  </body>
</html>

